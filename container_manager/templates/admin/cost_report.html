{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
    &rsaquo; <a href="{% url 'admin:container_manager_costbudget_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
    &rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>

<div class="module aligned">
    <h2>Cost Summary</h2>
    <table>
        <tr>
            <th>Total Cost:</th>
            <td>${{ summary.summary.total_cost }} {{ summary.summary.currency }}</td>
        </tr>
        <tr>
            <th>Total Jobs:</th>
            <td>{{ summary.summary.total_jobs }}</td>
        </tr>
        <tr>
            <th>Average Cost per Job:</th>
            <td>${{ summary.summary.avg_cost_per_job }} {{ summary.summary.currency }}</td>
        </tr>
        <tr>
            <th>Period:</th>
            <td>{{ summary.period.start|date:"M d, Y" }} - {{ summary.period.end|date:"M d, Y" }} ({{ summary.period.days }} days)</td>
        </tr>
    </table>
</div>

<div class="module aligned">
    <h2>Cost Breakdown</h2>
    <table>
        <tr>
            <th>CPU Costs:</th>
            <td>${{ summary.breakdown.cpu_costs }}</td>
        </tr>
        <tr>
            <th>Memory Costs:</th>
            <td>${{ summary.breakdown.memory_costs }}</td>
        </tr>
        <tr>
            <th>Storage Costs:</th>
            <td>${{ summary.breakdown.storage_costs }}</td>
        </tr>
        <tr>
            <th>Network Costs:</th>
            <td>${{ summary.breakdown.network_costs }}</td>
        </tr>
        <tr>
            <th>Request Costs:</th>
            <td>${{ summary.breakdown.request_costs }}</td>
        </tr>
        <tr>
            <th>Startup Costs:</th>
            <td>${{ summary.breakdown.startup_costs }}</td>
        </tr>
    </table>
</div>

<div class="module aligned">
    <h2>Cost by Executor</h2>
    <table>
        <thead>
            <tr>
                <th>Executor Type</th>
                <th>Total Cost</th>
                <th>Job Count</th>
                <th>Average Cost per Job</th>
            </tr>
        </thead>
        <tbody>
            {% for executor_type, data in summary.by_executor.items %}
            <tr>
                <td>{{ executor_type|capfirst }}</td>
                <td>${{ data.cost }}</td>
                <td>{{ data.jobs }}</td>
                <td>${{ data.cost|floatformat:6 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">No executor data available</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="module aligned">
    <h2>Budget Status</h2>
    <table>
        <thead>
            <tr>
                <th>Budget Name</th>
                <th>Budget Amount</th>
                <th>Current Spending</th>
                <th>Utilization</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for item in budget_status %}
            <tr>
                <td>{{ item.budget.name }}</td>
                <td>{{ item.budget.budget_amount }} {{ item.budget.currency }}</td>
                <td>{{ item.spending }} {{ item.budget.currency }}</td>
                <td>{{ item.thresholds.current_percentage|floatformat:1 }}%</td>
                <td>
                    {% if item.thresholds.budget_exceeded %}
                        <span style="color: red; font-weight: bold;">OVER BUDGET</span>
                    {% elif item.thresholds.critical_exceeded %}
                        <span style="color: red;">CRITICAL</span>
                    {% elif item.thresholds.warning_exceeded %}
                        <span style="color: orange;">WARNING</span>
                    {% else %}
                        <span style="color: green;">OK</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No active budgets</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="submit-row">
    <p><a href="{% url 'admin:container_manager_costbudget_changelist' %}" class="default">Back to Cost Budgets</a></p>
</div>

{% endblock %}